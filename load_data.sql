-- Carga de dados na tabela de permissões
INSERT INTO PERMISSAO (Id, Nome, Servico, Tipo)
VALUES 
	(CONVERT(UNIQUEIDENTIFIER, '6F9619FF-8B86-D011-B42D-00C04FC964FF'),
	'Cadastrar tarefas', '/api/tarefas', 'POST'),
	(CONVERT(UNIQUEIDENTIFIER, 'CB6B9117-986E-4BB1-ABDC-0DC195A5EBC3'), 
	'Consultar tarefas', '/api/tarefas', 'GET'),
	(CONVERT(UNIQUEIDENTIFIER, 'BDE5C7FC-781E-4F22-994B-23D9CC18CEA7'), 
	'Editar Tarefas', '/api/tarefas', 'PUT'),
	(CONVERT(UNIQUEIDENTIFIER, '4448624C-60DF-4EDF-A28F-F01216D13CAF'), 
	'Excluir Tarefas', '/api/tarefas', 'DELETE'),
	(CONVERT(UNIQUEIDENTIFIER, '75DDE814-DB25-4B99-ADD6-12B1AE75E9C4'), 
	'Consultar Categorias', '/api/categorias', 'GET'),
	(CONVERT(UNIQUEIDENTIFIER, 'CF0ABD16-0E58-4C12-ABD2-1A14F470AD5C'), 
	'Consultar Dashboard', '/api/dashboard', 'GET');
GO

SELECT * FROM PERMISSAO;
GO

-- Carga de dados na tabela de perfis
INSERT INTO PERFIL (Id, Nome)
VALUES 
	(CONVERT(UNIQUEIDENTIFIER, 'E42CE97D-EFB7-4259-9775-E103B45EA89D'), 'Administrador'),
	(CONVERT(UNIQUEIDENTIFIER, '187994E8-BD87-4566-9480-933B776E7B96'), 'Operador');
GO

SELECT * FROM PERFIL;
GO

-- Carga de dados na tabela de perfis_permissoes

-- Administrador tem acesso a todas as permissões
INSERT INTO PERFIL_PERMISSAO (PERFIL_ID, PERMISSAO_ID)
VALUES
    ('E42CE97D-EFB7-4259-9775-E103B45EA89D', '6F9619FF-8B86-D011-B42D-00C04FC964FF'),
    ('E42CE97D-EFB7-4259-9775-E103B45EA89D', 'CB6B9117-986E-4BB1-ABDC-0DC195A5EBC3'),
    ('E42CE97D-EFB7-4259-9775-E103B45EA89D', 'BDE5C7FC-781E-4F22-994B-23D9CC18CEA7'),
    ('E42CE97D-EFB7-4259-9775-E103B45EA89D', '4448624C-60DF-4EDF-A28F-F01216D13CAF'),
    ('E42CE97D-EFB7-4259-9775-E103B45EA89D', '75DDE814-DB25-4B99-ADD6-12B1AE75E9C4'),
    ('E42CE97D-EFB7-4259-9775-E103B45EA89D', 'CF0ABD16-0E58-4C12-ABD2-1A14F470AD5C');
GO

-- Operador só pode consultar (GET)
INSERT INTO PERFIL_PERMISSAO (PERFIL_ID, PERMISSAO_ID)
VALUES
    ('187994E8-BD87-4566-9480-933B776E7B96', 'CB6B9117-986E-4BB1-ABDC-0DC195A5EBC3'), -- Consultar tarefas
    ('187994E8-BD87-4566-9480-933B776E7B96', '75DDE814-DB25-4B99-ADD6-12B1AE75E9C4'), -- Consultar categorias
    ('187994E8-BD87-4566-9480-933B776E7B96', 'CF0ABD16-0E58-4C12-ABD2-1A14F470AD5C'); -- Consultar dashboard
GO

-- Consulta dos perfis e permissões
SELECT 
    P.Nome       AS Perfil,
    PE.Nome      AS Permissao,
    PE.Servico   AS Endpoint,
    PE.Tipo      AS MetodoHttp
FROM PERFIL_PERMISSAO PP
JOIN PERFIL P
    ON PP.PERFIL_ID = P.Id
JOIN PERMISSAO PE
    ON PP.PERMISSAO_ID = PE.Id
ORDER BY P.Nome, PE.Servico, PE.Tipo;